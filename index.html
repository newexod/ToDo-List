<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>ToDoList</title>
	<style>
		input, button, body {
			font-size: 30px;
		}
		.list {
			margin: 0;
			padding: 0;
		}
		.list li {
			list-style: none;
			background-color: gray;
			padding: 5px;
			margin: 5px;
		}
		.list li:after {
			content: '';
			display: block;
			clear: both;
		}
		.list li button {
			float: right;
		}
		.list li.passed {
			text-decoration: line-through;
			opacity: .5;
		}
		.hide {
			display: none;
		}
	</style>
</head>
<body>
	<button id="showHide">show/hide</button>
	<input id="new" type="text">
	<button id="add">Add</button>
	<ul class="list">
		<!-- <li>
			milk
			<button class="done">done</button>
			<button class="remove">remove</button>
		</li>
		<li class="passed">
			bread
			<button class="done">done</button>
			<button class="remove">remove</button>
		</li>
		<li>
			beer
			<button class="done">done</button>
			<button class="remove">remove</button>
		</li> -->
	</ul>
	<script>
		function Task(text, isDone) {
			this.text = text;
			this.isDone = isDone || false;
		};

		Task.prototype.done = function() {
			this.isDone = !this.isDone;
			console.log(this);
		};

		Task.prototype.el = function(n) {
			var el = document.createElement('li');
			el.innerText = this.text;

			var done = document.createElement('button');
			done.innerText = 'done';
			// done.classList.add('done'); // работает без этой строчки
			if (this.isDone) {
				el.classList.add('passed');
			}

			var self = this;
			done.addEventListener('click', function() {
				console.log(self)
				self.done();
				el.classList.toggle('passed');
				allTasks.save();

				if (isHide) {
					el.classList.add('hide');
				}
			});

			var remove = document.createElement('button');
			remove.innerText = 'remove';
			// remove.classList.add('remove'); // работает без этой строчки
			remove.addEventListener('click', function() {
				el.remove();
				delete allTasks[n];
				allTasks.save();
			})

			el.appendChild(done);
			el.appendChild(remove);

			return el;
		};

		function List() {}

		List.prototype = [];

		List.prototype.save = function() {
			localStorage.myApp = JSON.stringify(this);
		}


		var allTasks = new List();
		console.log(allTasks);

		if (localStorage.myApp) {
			var lastTasks = JSON.parse(localStorage.myApp);
			delete lastTasks.length;
			console.log(lastTasks);
			for(var i in lastTasks) {
				lastTasks[i];
				var task = new Task(lastTasks[i].text, lastTasks[i].isDone);
				var num = allTasks.push(task) - 1;
				document.querySelector('.list').appendChild(task.el(num));
			}
		}

		var isHide = false;

		var add = document.getElementById('add');
		add.addEventListener('click', function(event) { // добавляет новый таск
			var text = document.getElementById('new').value;
			var task = new Task(text); // {text: ...., isDone: false}
			var num = allTasks.push(task) - 1;
			console.log(num);

			document.querySelector('.list').appendChild(task.el(num));
			allTasks.save();
		});


		document.getElementById('showHide')
			.addEventListener('click', function() {
				isHide = !isHide;
				var els = document.querySelectorAll('.passed');
				[].forEach.call(els, function(item) {
					item.classList.toggle('hide');
				});
			});


		/*<p class="editing">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Minus, iure?</p>
		<p class="editing">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptas quos quisquam ea accusantium, iste dolores.</p>

		<button id="edit">edit</button>
		<script>

			var edit = document.getElementById('edit');
			edit.addEventListener('click', function(event) {
				var p, input, text, text2, button;

				text = document.getElementsByClassName('editing');
				console.log(text)

				button = event.target;
				console.log(button)

				var self = this;
				if (button) {
					for (var i = 0; i < text.length; i++) {
						text[i].style.display = 'none';

						this.p = text[i].innerHTML;					

						this.input = document.createElement("input");
						this.input.type = "text";
						text[i].parentNode.insertBefore(this.input, text[1]);

						this.input.focus();
						console.log(this.input)

						this.input.onblur = function() {
							console.log(text[i]);
							// console.log(this.input)
						  	text[i].parentNode.removeChild(this.input);

						  	text[i].innerHTML = this.input.value;

						  	text[i].style.display = "";
						}
					}
				
				}
			});*/
	</script>
</body>
</html>